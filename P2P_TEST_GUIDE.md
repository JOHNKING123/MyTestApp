# P2P群聊测试指南

## 测试环境要求

1. 两个Android模拟器或真机
2. 确保两个设备在同一网络环境下
3. 确保应用有网络权限

## 正确的测试流程

### 第一步：群组创建者（模拟器A）

1. 启动应用
2. 设置用户信息（如果还没有设置）
3. 创建群组
   - 点击"创建群组"
   - 输入群组名称（如"测试群组"）
   - 点击确认
4. 确认P2P服务器启动
   - 查看日志：应该显示"P2P服务器启动成功"
   - 查看群组列表：应该显示刚创建的群组
5. 显示群组二维码
   - 长按群组 → 显示二维码
   - 或者进入群组聊天界面 → 点击二维码按钮

### 第二步：群组成员（模拟器B）

1. 启动应用
2. 设置用户信息（如果还没有设置）
3. 加入群组
   - 点击"加入群组"
   - 扫描模拟器A显示的二维码
   - 或者手动输入二维码数据

## 常见问题排查

### 问题1：连接被拒绝

**症状**：日志显示"Connection refused"

**可能原因**：
1. 群组创建者的P2P服务器未启动
2. 端口号不正确
3. IP地址不正确
4. 网络配置问题

**解决方案**：
1. 确保群组创建者已成功创建群组
2. 检查日志中P2P服务器启动信息
3. 确认二维码中的IP和端口信息正确

### 问题2：二维码扫描失败

**症状**：无法扫描二维码或解析失败

**可能原因**：
1. 二维码数据格式错误
2. 二维码显示不清晰
3. 扫码权限未授权

**解决方案**：
1. 检查二维码是否完整显示
2. 确保已授权摄像头权限
3. 尝试手动输入二维码数据

### 问题3：消息发送失败

**症状**：消息无法发送或接收

**可能原因**：
1. P2P连接断开
2. 加密密钥问题
3. 消息格式错误

**解决方案**：
1. 检查P2P连接状态
2. 重新加入群组
3. 查看错误日志

## 调试技巧

### 查看详细日志

应用会输出详细的调试信息，包括：
- P2P服务器启动状态
- 连接测试结果
- 消息发送接收状态
- 错误信息

### 手动测试连接

可以使用以下命令测试网络连接：
```bash
# 测试端口是否开放
telnet <IP地址> <端口号>

# 或者使用nc命令
nc -zv <IP地址> <端口号>
```

### 检查网络配置

1. 确保两个设备在同一网络
2. 检查防火墙设置
3. 确认端口8080未被其他应用占用

## 预期结果

### 成功创建群组
- 日志显示"P2P服务器启动成功"
- 群组列表显示新创建的群组
- 可以显示群组二维码

### 成功加入群组
- 日志显示"连接测试成功"
- 日志显示"WebSocket连接成功"
- 群组列表显示加入的群组
- 可以进入群组聊天

### 成功发送消息
- 消息显示在聊天界面
- 其他成员可以收到消息
- 消息内容正确解密显示

## 注意事项

1. **网络环境**：确保两个设备在同一网络环境下
2. **权限设置**：确保应用有网络和摄像头权限
3. **端口占用**：确保8080端口未被其他应用占用
4. **防火墙**：检查防火墙是否阻止连接
5. **模拟器网络**：Android模拟器可能需要特殊网络配置

## 故障排除步骤

1. 检查应用日志，查找错误信息
2. 确认P2P服务器是否启动
3. 测试网络连接
4. 重新创建群组和加入
5. 重启应用和设备 