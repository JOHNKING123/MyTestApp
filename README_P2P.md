# P2P 端到端加密群聊应用

## 架构概述

这是一个**去中心化的P2P群聊应用**，采用端到端加密技术，无需中央服务器。

### 核心特性

- 🔐 **端到端加密**: 使用AES-256-GCM加密所有消息
- 🌐 **P2P通信**: 群组创建者作为临时服务器，成员直接连接
- 📱 **二维码加入**: 通过扫描二维码快速加入群组
- 🔄 **实时同步**: WebSocket实时消息同步
- 💾 **本地存储**: 跨平台本地数据存储

## P2P通信架构

### 工作原理

1. **群组创建**
   - 用户创建群组时，应用启动本地WebSocket服务器
   - 生成群组密钥对和会话密钥
   - 创建包含服务器地址的二维码

2. **成员加入**
   - 扫描群组二维码获取服务器地址和密钥
   - 直接连接到群组创建者的WebSocket服务器
   - 发送加入请求，获取群组密钥

3. **消息传输**
   - 消息使用群组会话密钥加密
   - 通过P2P网络广播给所有成员
   - 每个成员解密并显示消息

### 技术栈

- **前端**: Flutter (跨平台)
- **加密**: AES-256-GCM + PointyCastle
- **通信**: WebSocket (dart:io)
- **存储**: SQLite (移动端) / Hive (Web端)
- **二维码**: qr_flutter + qr_code_scanner

## 文件结构

```
lib/
├── models/           # 数据模型
│   ├── user.dart     # 用户模型
│   ├── group.dart    # 群组模型
│   ├── message.dart  # 消息模型
│   └── member.dart   # 成员模型
├── services/         # 核心服务
│   ├── p2p_service.dart      # P2P通信服务
│   ├── encryption_service.dart # 加密服务
│   ├── key_service.dart      # 密钥管理
│   ├── group_service.dart    # 群组管理
│   └── storage_service.dart  # 本地存储
├── providers/        # 状态管理
│   └── app_provider.dart     # 应用状态
└── screens/          # UI界面
    ├── chat_screen.dart      # 聊天界面
    ├── join_group_screen.dart # 加入群组
    └── group_list_screen.dart # 群组列表
```

## 安全特性

### 加密机制

1. **群组密钥对**: ECDSA密钥对用于群组身份验证
2. **会话密钥**: AES-256-GCM用于消息加密
3. **消息签名**: SHA-256哈希验证消息完整性
4. **密钥轮换**: 定期更新会话密钥

### 隐私保护

- 所有消息本地加密存储
- 密钥不离开设备
- 无中央服务器存储用户数据
- 支持消息自毁功能

## 使用方法

### 创建群组

1. 启动应用，设置用户名
2. 点击"创建群组"
3. 输入群组名称
4. 应用自动启动P2P服务器
5. 显示群组二维码供其他用户扫描

### 加入群组

1. 点击"加入群组"
2. 扫描群组二维码
3. 应用自动连接到群组服务器
4. 开始聊天

### 发送消息

1. 选择群组进入聊天界面
2. 输入消息内容
3. 消息自动加密并广播给所有成员
4. 其他成员实时接收并解密显示

## 网络要求

- **局域网**: 群组成员需在同一局域网内
- **端口**: 默认使用8080端口
- **防火墙**: 需要允许WebSocket连接

## 扩展功能

### 计划中的功能

- [ ] 多设备同步
- [ ] 离线消息缓存
- [ ] 文件传输加密
- [ ] 语音/视频通话
- [ ] 群组权限管理
- [ ] 消息撤回功能

### 技术改进

- [ ] WebRTC P2P连接
- [ ] 分布式哈希表(DHT)
- [ ] 区块链身份验证
- [ ] 零知识证明

## 开发说明

### 环境要求

- Flutter 3.0+
- Dart 2.17+
- Android Studio / VS Code

### 运行项目

```bash
# 安装依赖
flutter pub get

# 生成代码
flutter packages pub run build_runner build

# 运行应用
flutter run
```

### 测试P2P功能

1. 在多个设备上运行应用
2. 确保设备在同一网络
3. 创建群组并邀请其他设备加入
4. 测试消息发送和接收

## 注意事项

1. **网络限制**: 当前版本仅支持局域网通信
2. **设备要求**: 需要摄像头权限用于扫描二维码
3. **存储权限**: 需要本地存储权限保存数据
4. **防火墙**: 可能需要配置防火墙允许WebSocket连接

## 许可证

MIT License - 详见 LICENSE 文件 